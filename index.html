<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Allowance Calculator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  /* Modal popup styles */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }
  .modal-overlay.active {
    display: flex;
  }
  .modal {
    background: white;
    padding: 20px 30px;
    border-radius: 8px;
    max-width: 320px;
    width: 100%;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  .modal h2 {
    margin-top: 0;
  }
  .modal label {
    display: block;
    margin: 12px 0 6px;
  }
  .modal input[type="number"],
  .modal select {
    width: 100%;
    padding: 8px 6px;
    box-sizing: border-box;
  }
  .modal button {
    margin-top: 16px;
    width: 100%;
    padding: 10px;
    background-color: #04AA6D;
    border: none;
    color: white;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 4px;
  }
  .modal button:hover {
    background-color: #039f5b;
  }

  /* Output table styled like Excel cells J1:L33 */
  table {
    border-collapse: collapse;
    margin-top: 30px;
    width: 300px;
  }
  th, td {
    border: 1px solid #999;
    padding: 6px 10px;
    text-align: center;
    font-family: monospace;
  }
  th {
    background-color: #f0f0f0;
  }
  .total-row {
    font-weight: bold;
    background-color: #d0f0d0;
  }
</style>
</head>
<body>

<!-- Modal popup -->
<div class="modal-overlay" id="popup">
  <div class="modal">
    <h2>Enter USD Rate & Allowance Category</h2>
    <form id="inputForm">
      <label for="usdRate">USD Rate (LKR per USD):</label>
      <input type="number" id="usdRate" name="usdRate" min="0" step="0.01" required />

      <label for="allowanceCategory">Allowance Category:</label>
      <select id="allowanceCategory" name="allowanceCategory" required>
        <option value="" disabled selected>Select category</option>
        <option value="125">A (125 USD)</option>
        <option value="500">B (500 USD)</option>
        <option value="1000">C (1000 USD)</option>
        <option value="125">D2 (125 USD)</option>
      </select>

      <button type="submit">Submit</button>
    </form>
  </div>
</div>

<!-- Output Table -->
<div id="outputContainer" style="display:none;">
  <table id="outputTable" aria-label="Allowance Calculation Output">
    <thead>
      <tr>
        <th>J</th>
        <th>K</th>
        <th>L</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be generated by jQuery -->
    </tbody>
  </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function() {
  const popup = $('#popup');
  const outputContainer = $('#outputContainer');
  const outputTableBody = $('#outputTable tbody');

  // Show popup on page load
  popup.addClass('active');

  // Memorize values
  let usdRate = null;
  let allowanceValue = null;

  // Generate output table rows
  function generateOutput() {
    outputTableBody.empty();

    // Let's create 33 rows (like J1:L33)
    // We'll fill columns J and K with some dummy data,
    // column L will have calculated values to sum to allowanceValue * usdRate

    // For simplicity, fill J with row number, K with "Item X", L with equal parts of total
    const total = allowanceValue * usdRate;
    const rowsCount = 33;
    const perRowValue = total / rowsCount;

    for(let i=1; i<=rowsCount; i++) {
      const jCell = i; // Just row number
      const kCell = `Item ${i}`;
      // For the last row, adjust value to avoid floating point sum errors
      const lCell = (i === rowsCount) ? (total - perRowValue*(rowsCount-1)) : perRowValue;

      outputTableBody.append(
        `<tr>
          <td>${jCell}</td>
          <td>${kCell}</td>
          <td>${lCell.toFixed(2)}</td>
        </tr>`
      );
    }

    // Add total row
    outputTableBody.append(
      `<tr class="total-row">
        <td colspan="2">Total</td>
        <td>${total.toFixed(2)}</td>
      </tr>`
    );
  }

  // Handle form submission
  $('#inputForm').on('submit', function(e) {
    e.preventDefault();
    usdRate = parseFloat($('#usdRate').val());
    allowanceValue = parseFloat($('#allowanceCategory').val());

    if (isNaN(usdRate) || usdRate <= 0) {
      alert('Please enter a valid USD rate.');
      return;
    }
    if (isNaN(allowanceValue) || allowanceValue <= 0) {
      alert('Please select a valid allowance category.');
      return;
    }

    // Hide popup
    popup.removeClass('active');

    // Show output container
    outputContainer.show();

    // Generate output table
    generateOutput();
  });
});
</script>

</body>
</html>
