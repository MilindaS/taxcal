<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allowance Calculator with AJAX</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #inputForm {
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 80%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .total-row {
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h2>Allowance Calculator</h2>

    <form id="inputForm">
        <label for="usdRate">USD Rate:</label>
        <input type="number" id="usdRate" name="usdRate" required><br><br>

        <label for="allowanceCategory">Allowance Category:</label>
        <select id="allowanceCategory" name="allowanceCategory" required>
            <option value="125">A (125 USD)</option>
            <option value="500">B (500 USD)</option>
            <option value="1000">C (1000 USD)</option>
            <option value="125">D2 (125 USD)</option>
        </select><br><br>

        <button type="button" id="calculateBtn">Calculate</button>
    </form>

    <table id="outputTable">
        <thead>
            <tr>
                <th>J</th>
                <th>K</th>
                <th>L</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <script>
        $(document).ready(function() {
            // Load JSON data using AJAX
            $.ajax({
                url: 'data.json', // Replace with the actual path to your JSON file
                dataType: 'json',
                success: function(jsonData) {
                    // Handle calculation when the button is clicked
                    $('#calculateBtn').click(function() {
                        var usdRate = parseFloat($('#usdRate').val());
                        var allowanceCategory = parseFloat($('#allowanceCategory').val());

                        if (isNaN(usdRate) || isNaN(allowanceCategory)) {
                            alert('Please enter valid numbers for USD Rate and Allowance Category.');
                            return;
                        }

                        var totalValue = usdRate * allowanceCategory;
                        var tableRows = '';
                        var itemsUsed = [];

                        // Generate 33 rows
                        for (var i = 1; i <= 33; i++) {
                            // Pick a random item from jsonData
                            var randomIndex = Math.floor(Math.random() * jsonData.length);
                            var randomItem = jsonData[randomIndex];

                            // Ensure we don't use the same item twice (optional)
                            while (itemsUsed.includes(randomIndex)) {
                                randomIndex = Math.floor(Math.random() * jsonData.length);
                                randomItem = jsonData[randomIndex];
                            }
                            itemsUsed.push(randomIndex);

                            // Calculate value for L column
                            var itemValue = parseFloat(randomItem.Value);
                            if (isNaN(itemValue)) {
                                itemValue = 0; // Handle cases where value is not a number
                            }

                            tableRows += '<tr>';
                            tableRows += '<td>' + i + '</td>'; // J column (row number)
                            tableRows += '<td>' + randomItem.Item + '</td>'; // K column (item name)
                            tableRows += '<td>' + itemValue.toFixed(2) + '</td>'; // L column (item value)
                            tableRows += '</tr>';
                        }

                        // Add total row
                        tableRows += '<tr class="total-row">';
                        tableRows += '<td colspan="2">Total</td>';
                        tableRows += '<td>' + totalValue.toFixed(2) + '</td>'; // Display the calculated total
                        tableRows += '</tr>';

                        // Update the table
                        $('#outputTable tbody').html(tableRows);
                    });
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    alert('Error loading JSON data: ' + textStatus + ', ' + errorThrown);
                }
            });
        });
    </script>

</body>
</html>
